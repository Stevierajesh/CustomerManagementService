<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrentWEB</title>
  <link rel="stylesheet" href="styles.css"> <!-- Navbar styles are in this external file -->
  <style>
    /* Dashboard Container */
    .dashboard-container {
      display: flex;
      gap: 20px;
      padding: 20px;
      height: calc(100vh - 160px); /* Full viewport height minus navbar height */
    }

    /* Left Panel */
    .left-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Right Panel */
    .right-panel {
      flex: 2;
      background-color: #a9a9a9; /* Light blue */
      padding: 20px;
      border-radius: 8px;
    }

    /* Donut Chart with Square */
    .revenue-container {
      position: relative; /* Positioning for the square and donut */
      width: 100%; /* Match the width of Recent Customers */
      display: flex;
      flex-direction: column; /* Stack title and donut chart */
      align-items: center; /* Center content horizontally */
      justify-content: flex-start; /* Align content at the top */
    }

    .revenue-square {
      position: relative; /* Make the square a positioned element */
      width: 100%; /* Full width */
      height: 100%; /* Full height */
      background-color: #a9a9a9; /* Gray square */
      border-radius: 8px; /* Rounded corners */
      z-index: 1; /* Keep it behind the donut */
      display: flex;
      flex-direction: column; /* Stack title and donut chart */
      align-items: center; /* Center horizontally */
      padding-top: 10px; /* Add some space from the top */
    }

    .revenue-title {
      position: relative; /* Position relative to the square */
      font-size: 18px;
      font-weight: bold;
      color: #333; /* Visible text color */
      background-color: #f7f7f7; /* Background for contrast */
      padding: 5px 10px; /* Padding around text */
      border-radius: 4px; /* Rounded corners */
      z-index: 2; /* Ensure it's above the square */
      margin-bottom: 10px; /* Add spacing between title and donut chart */
    }

    /* Recent Customers Section */
    .recent-customers {
      background-color: #a9a9a9; /* Gray */
      flex: 1;
      border-radius: 8px;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: bold;
      color: #333;
    }

    /* Appointments Section */
    .appointments {
      background-color: #a9a9a9; /* Slightly lighter blue */
      border-radius: 8px;
      padding: 20px;
      overflow-y: auto; 
      max-height: calc(100vh - 200px); /* Adjust height to fit the viewport */
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px; /* Spacing between items */
    }

    .appointments h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: bold;
      color: #333; /* Title text color */
    }

    .appointment-item {
      background-color: #ffffff; /* White background */
      width: 90%; /* 90% width of the appointments section */
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Subtle shadow for items */
      text-align: center; /* Center align text */
      font-size: 16px;
      font-weight: bold;
      color: #333; /* Text color */
      transition: background-color 0.3s ease, box-shadow 0.3s ease; /* Smooth transition */
      margin-bottom: 9px;
    }
    .appointments-list {
      width: 100%;
      max-height: 350px; /* Set a fixed height to enable scrolling */
      overflow-y: auto; /* Allows scrolling within this section */
      padding-right: 10px; /* Prevents content from getting cut off */
    }

    .add-appointment-container {
  display: flex;
  justify-content: center;
  align-items: center;
  padding-top: 10px; /* Adds spacing above the button */
}

.add-appointment-btn {
  background-color: #444;
  color: white;
  font-size: 16px;
  font-weight: bold;
  padding: 12px 24px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease, transform 0.2s ease;
}

.add-appointment-btn:hover {
  background-color: #555;
  transform: scale(1.05);
}

    .appointment-item:hover {
      background-color: #6b92b4; /* Light blue background on hover */
      border: 2px solid #63bfc5;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); /* Stronger shadow on hover */
      cursor: pointer; /* Pointer cursor on hover */
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .dashboard-container {
        flex-direction: column; /* Stack panels vertically */
        height: auto; /* Let height adjust to content */
      }

      .left-panel,
      .right-panel {
        flex: 1;
      }
    }

    @media (max-width: 768px) {
      .dashboard-container {
        padding: 10px; /* Smaller padding */
        gap: 10px;
      }
    }

    .navbar .nav-links li a.exit-link {
      border: 2px solid red; /* Red border for exit link */
    }
    /* Modal Background */
/* Modal Overlay */
.modal {
    display: none; /* Hidden by default */
    position: fixed;
    z-index: 1000; /* Ensures it appears above everything */
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black background */
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Prevents full-page scrolling */
}

/* Modal Content Box */
.modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    width: 400px;
    max-width: 90%;
    max-height: 80vh; /* Restrict the modal height */
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    overflow-y: auto; /* Enables vertical scrolling when needed */
}

/* Close (X) Button */
.close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
}

/* Form Styling */
.modal-content form {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Labels */
.modal-content label {
    font-weight: bold;
    margin-top: 10px;
    text-align: left;
    width: 90%;
}

/* Input Fields */
.modal-content input,
.modal-content select {
    width: 90%;
    padding: 10px;
    margin: 5px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
}

/* Buttons Container */
.modal-buttons {
    display: flex;
    justify-content: space-between;
    width: 90%;
    margin-top: 15px;
}

/* Submit Button */
.submit-btn {
    background-color: #444;
    color: white;
    font-size: 16px;
    font-weight: bold;
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    width: 48%;
}

.submit-btn:hover {
    background-color: #555;
    transform: scale(1.05);
}

/* Cancel Button */
.cancel-btn {
    background-color: #bbb;
    color: black;
    font-size: 16px;
    font-weight: bold;
    padding: 12px 24px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    width: 48%;
}

.cancel-btn:hover {
    background-color: #999;
    transform: scale(1.05);
}

/* Dropdown Select */
.modal-content select {
    width: 90%;
    padding: 10px;
    margin: 5px 0;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
    background-color: white;
    cursor: pointer;
}


  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <ul class="nav-links">
      <li><a href="login.html" class="exit-link" style="color: red;">Exit</a></li>
      <li><a href="dashboard.html">Main</a></li>
      <li><a href="finances.html">Finances</a></li>
      <li><a href="crm.html">CRM</a></li>
      <li><a href="accounts.html">Account</a></li>
      <li><a href="products.html">Products</a></li>
    </ul>
  </nav>

  <!-- Dashboard Layout -->
  <div class="dashboard-container">
    <!-- Left Panel -->
    <div class="left-panel">
      <div class="revenue-container">
        <div class="revenue-square">
          <h2 class="revenue-title">Revenue</h2>
          <canvas id="myChart" style="width:100%; max-width:400px;"></canvas>
        </div>
      </div>
      
      <div class="recent-customers">
        Pending Appointments
      </div>
    </div>

    <!-- Right Panel -->
    <div class="right-panel appointments">
      <h2 id="appointmentsHeader">Upcoming Appointments</h2>
      <div class="appointments-list" style="width: 100%; margin-left: 100px;">
      </div>
      <div class="add-appointment-container">
        <button class="add-appointment-btn">Add an Appointment</button>
      </div>
    </div>
  </div>

  <!-- Modal Background (Hidden by Default) -->
<div id="appointmentModal" class="modal">
  <div class="modal-content">
      <!-- Close (X) Button -->
      <span class="close">&times;</span>
      
      <h2>Add New Appointment</h2>
      
      <!-- Appointment Form -->
      <form id="appointmentForm">
          <label for="firstName">First Name:</label>
          <input type="text" id="firstName" name="firstName" required>

          <label for="lastName">Last Name:</label>
          <input type="text" id="lastName" name="lastName" required>

          <label for="phone">Phone:</label>
          <input type="text" id="phone" name="phone" required>

          <label for="email">Email:</label>
          <input type="email" id="email" name="email" required>
          <label for="carType">Car Type:</label>
          <select id="carType" name="carType" required>
              <option value="Sedan">Sedan</option>
              <option value="SUV">SUV</option>
              <option value="Truck">Truck</option>
              <option value="Coupe">Coupe</option>
              <option value="Van">Van</option>
              <option value="Other">Other</option>
          </select>
          <label for="carMakeAndModel">Car Make and Model:</label>
          <input type="text" id="carMakeAndModel" name="carMakeAndModel" required>

          <label for="service">Requested Service:</label>
          <input type="text" id="service" name="service" required>

          <label for="pethair">Pet Hair Removal?</label>
          <select id="pethair" name="pethair">
              <option value="No">No</option>
              <option value="Yes">Yes</option>
          </select>

          <label for="shampoo">Seats Need Shampooing?</label>
          <select id="shampoo" name="shampoo">
              <option value="No">No</option>
              <option value="Yes">Yes</option>
          </select>
          <label for="appointmentDate">Appointment Date:</label>
          <input type="date" id="appointmentDate" required>
      
          <label for="appointmentTime">Appointment Time:</label>
          <input type="time" id="appointmentTime" required>
          
          <!-- Buttons: Submit & Cancel -->
          <div class="modal-buttons">
              <button type="submit" class="submit-btn">Add Appointment</button>
              <button type="button" class="cancel-btn">Cancel</button>
          </div>
      </form>
  </div>
</div>

<iframe 
    src="https://calendar.google.com/calendar/embed?src=b28613958d0db09b09bbc3cf854de72e128c0442b12794e231c4a4d08e522067%40group.calendar.google.com&ctz=America%2FNew_York" 
    style="border: none;filter: invert(1); width: 90%; height: 80vh; margin-top: 5vh; display: block; margin-left: auto; margin-right: auto;"
></iframe>

<br>
<br>
<br>
<br>
<br>
<br>
<footer>
  © 2025 THEJUS-Interactive. All rights reserved.
</footer>


  <div id="error-notifications-container"></div>
  <script src="../js/system.bundle.js" type="module"></script>
  <script src="../js/app.bundle.js" type="module">console.log('Appointments page loaded');</script>
  <script src="../js/auth.bundle.js" type="module"></script>
  
  <script>
    document.addEventListener("DOMContentLoaded", function () {
    // Get modal elements
    const modal = document.getElementById("appointmentModal");

    modal.style.display = "none";

    const openModalBtn = document.querySelector(".add-appointment-btn"); // Button that opens modal
    const closeModalBtn = document.querySelector(".close"); // 'X' close button
    const cancelModalBtn = document.querySelector(".cancel-btn"); // Cancel button
    const form = document.getElementById("appointmentForm"); // Form inside modal

    // Open Modal
    openModalBtn.addEventListener("click", function () {
        modal.style.display = "flex";
    });

    // Close Modal (X Button)
    closeModalBtn.addEventListener("click", function () {
        modal.style.display = "none";
        form.reset(); // Reset form fields when closed
    });

    // Close Modal (Cancel Button)
    cancelModalBtn.addEventListener("click", function () {
        modal.style.display = "none";
        form.reset(); // Reset form fields when canceled
    });

    // Close Modal When Clicking Outside the Modal
    window.addEventListener("click", function (event) {
        if (event.target === modal) {
            modal.style.display = "none";
            form.reset(); // Reset form fields when clicking outside
        }
    });

    // Handle Form Submission
    form.addEventListener("submit", async function (event) {
        event.preventDefault(); // Prevent actual form submission

        // Collect form data
        const appointmentData = {
          FirstName: document.getElementById("firstName").value.trim(),
            LastName: document.getElementById("lastName").value.trim(),
            Phone: document.getElementById("phone").value.trim(),
            Email: document.getElementById("email").value.trim(),
            CarType: document.getElementById("carType").value.trim(),
            CarMakeAndModel: document.getElementById("carMakeAndModel").value.trim(),
            Service: document.getElementById("service").value,
            PetHair: document.getElementById("pethair").checked, // Checkbox returns true/false
            SeatsShampooed: document.getElementById("shampoo").checked, // Checkbox returns true/false
            appointmentDate: document.getElementById("appointmentDate").value,
            appointmentTime: document.getElementById("appointmentTime").value
        };

        console.log("Appointment Data:", appointmentData); // Debugging output

        if (!appointmentData.FirstName || !appointmentData.LastName || !appointmentData.Phone || 
            !appointmentData.Email || !appointmentData.Service || !appointmentData.appointmentDate || 
            !appointmentData.appointmentTime) {
            console.error("Please fill in all required fields.");
            return;
        }

        try {
            // Send Data to Backend
            const response = await fetch("http://localhost:7777/appointments", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(appointmentData)
            });

            const result = await response.json();
            console.log("Response from server:", result);

            if (response.ok) {
                alert("Appointment successfully booked!");
                form.reset(); // Reset the form after successful submission
                modal.style.display = "none"; // Close the modal
            } else {
                alert("Failed to book appointment: " + result.error);
            }
        } catch (error) {
            console.error("Error sending data:", error);
            alert("Error: Unable to connect to server.");
        }

        // Close modal and reset form
        modal.style.display = "none";
        form.reset();
    });
});

    async function fetchAppointmentItems() {
      try {
        // Fetch data from the backend
        const response = await fetch('http://localhost:7777/appointments');
        
        if (!response.ok) {
          throw new Error('Failed to fetch appointments items');
        }

        // Parse the JSON response
        const items = await response.json();

        // Get the container for the appointments list
        const appointmentsContainer = document.querySelector('.appointments-list');

        // Clear any existing content in the container
        appointmentsContainer.innerHTML = '';

        // Loop through the fetched items and create appointment-item divs
        items.forEach(item => {
          const appointmentDiv = document.createElement('div');
          appointmentDiv.className = 'appointment-item';

          // Set the content of each appointment item
          appointmentDiv.textContent = `${item.FirstName} ${item.LastName} - ${item.Service} (${item.appointmentDate} ${item.appointmentTime})`;

          // Add an onclick handler for interactivity (if needed)
          appointmentDiv.onclick = async () => {
            try {
              const appointmentId = item['_id']; // Correctly accessing the _id property

              // Redirect to appointmentDetails.html with the appointment ID as a query parameter
              window.location.href = `appointmentDetails.html?appointmentId=${appointmentId}`;
            } catch (error) {
              console.error('Error handling appointment selection:', error);
            }
          };

          // Append the appointment item to the container
          appointmentsContainer.appendChild(appointmentDiv);
        });

        console.log('Appointments successfully populated');
      } catch (error) {
        console.error('Error fetching appointments items:', error);
      }
    }
    // Call the function when the page loads
    window.onload = fetchAppointmentItems;
  </script>
</body>
</html>
